<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile-prepay</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

    <style>
        .navbar {
            background-color: #1B4D3E !important;
        }

        .navbar .nav-link,
        .navbar .navbar-brand,
        .navbar .nav-link.dropdown-toggle {
            color: white !important;
        }

        .navbar .nav-link:hover,
        .navbar .nav-link:focus {
            color: #f8f9fa !important;
        }

        /* Full-Width Carousel */
        .swiper {
            width: 95%;
            height: 450px;
            margin-top: 20px;
            perspective: 1200px;
        }

        .swiper-slide {
            background-size: cover;
            background-position: center;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Change Swiper Navigation Buttons to White */
        .swiper-button-prev,
        .swiper-button-next {
            color: white !important;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
        }

        .swiper-button-prev::after,
        .swiper-button-next::after {
            font-size: 24px;
            font-weight: bold;
            color: white !important;
        }

        .swiper-button-prev:hover,
        .swiper-button-next:hover {
            background: rgba(255, 255, 255, 0.6);
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .toggle-switch {
            width: 40%;
            height: 50px;
            background: #ddd;
            border-radius: 25px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle-switch::before {
            content: "Admin";
            width: 50%;
            height: 45px;
            background: white;
            border-radius: 25px;
            position: absolute;
            top: 2px;
            left: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #000;
            transition: 0.3s;
        }

        .toggle-checkbox {
            display: none;
        }

        .toggle-checkbox:checked + .toggle-switch {
            background: #1B4D3E;
        }

        .toggle-checkbox:checked + .toggle-switch::before {
            transform: translateX(100%);
            content: "Subscriber";
            color: white;
            background: #1B4D3E;
        }

        /* Error Message Styling */
        .error-message {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>

<body>

<!-- Navbar -->
<div class="navbar navbar-expand-md bg-body-tertiary fixed-top">
    <div class="container-fluid">
        <a href="../Subscribers/Login_page.html" class="navbar-brand text-decoration-none ms-2"><img src="images/prezee2.png" style="width: 50px;"></a>
        <button class="navbar-toggler" data-bs-target="#links" data-bs-toggle="collapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="links" class="collapse navbar-collapse justify-content-end">
            <ul class="navbar-nav">
                <li class="nav-item"><a href="#" id="profilelogo" class="nav-link me-4"><i class="bi bi-person-fill text-white fs-3 ps-2"></i></a></li>
            </ul>
        </div>
    </div>
</div>

<!-- 3D Carousel -->
<div class="container d-flex justify-content-center align-items-center" style="margin-top: 60px;">
    <div class="swiper mySwiper">
        <div class="swiper-wrapper">
            <div class="swiper-slide" style="background-image: url('images/Screenshot\ \(753\).png');"></div>
            <div class="swiper-slide" style="background-image: url('images/happy.jpg');"></div>
            <div class="swiper-slide" style="background-image: url('images/pexels-photo-3791664.webp');"></div>
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
    </div>
</div>

<!-- Toggle Switch -->
<div class="toggle-container">
    <input type="checkbox" id="toggle-role" class="toggle-checkbox">
    <label for="toggle-role" class="toggle-switch"></label>
</div>

<!-- Login Form -->
<div class="container mt-4 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4 shadow">
                <h3 class="text-center mb-3">Admin Login</h3>
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">User Name <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="username" placeholder="Enter your User Name">
                        <span id="usernameError" class="error-message"></span>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password <span style="color: red;">*</span></label>
                        <input type="password" class="form-control" id="password" placeholder="Enter your Password">
                        <span id="passwordError" class="error-message"></span>
                    </div>
                    <button type="submit" class="btn rounded-4" style="background-color: #1B4D3E; color: white; margin-left: 205px; width: 150px;">Login</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS (required for navbar toggle) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript -->
<script>
    // Initialize Swiper
    const swiper = new Swiper('.mySwiper', {
        loop: true,
        effect: 'slide',
        grabCursor: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
    });

    // Toggle Switch Logic
    document.getElementById("toggle-role").addEventListener("change", function() {
        if (this.checked) {
            window.location.href = "../Subscribers/Login_page.html"; // Redirect to Subscriber login
        }
    });

    // Login Form Submission
    document.getElementById("loginForm").addEventListener("submit", function(event) {
        event.preventDefault();

        let username = document.getElementById("username").value.trim();
        let password = document.getElementById("password").value.trim();
        let usernameError = document.getElementById("usernameError");
        let passwordError = document.getElementById("passwordError");

        usernameError.textContent = "";
        passwordError.textContent = "";

        let isValid = true;

        // Relaxed client-side validation to match backend
        if (username === "") {
            usernameError.textContent = "Username is required.";
            isValid = false;
        }
        if (password === "") {
            passwordError.textContent = "Password is required.";
            isValid = false;
        }

        if (isValid) {
            // Prepare data for backend
            const loginData = {
                username: username,
                password: password
            };

            console.log('Sending login request:', loginData);

            // Make POST request to backend login endpoint
            fetch('http://localhost:8083/api/public/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(loginData)
            })
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid username or password');
                    } else {
                        return response.text().then(text => {
                            throw new Error(`Login failed with status: ${response.status} - ${text}`);
                        });
                    }
                }
                return response.text(); // JWT token is returned as plain text
            })
            .then(token => {
                // Store the JWT token in localStorage
                localStorage.setItem('jwtToken', token);
                console.log('Login successful, JWT:', token);
                // Redirect to admin dashboard
                window.location.href = "Dashboard.html";
            })
            .catch(error => {
                console.error('Fetch error details:', error);
                passwordError.textContent = error.message || 'Failed to connect to the server. Please ensure the backend is running and try again.';
            });
        }
    });
</script>

</body>
</html>