<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plans Page</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #f2f5fa 100%);
            margin: 0;
            padding: 0;
        }

        /* Navbar */
        .navbar {
            background-color: #1B4D3E !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 10px 30px;
            height: 70px;
        }
        .navbar .nav-link, .navbar .navbar-brand {
            color: white !important;
            transition: transform 0.3s ease;
        }
        .navbar .nav-link:hover {
            transform: scale(1.1);
        }

        /* Breadcrumbs */
        #bread {
            background-color: #dce8e4;
            margin: 0px;
        }
        .breadcrumbs {
            font-size: 16px;
            padding: 10px;
            border-radius: 5px;
            width: fit-content;
            margin: 74px 0 20px 27px;
            background-color: #dce8e4;
        }
        .breadcrumbs a {
            text-decoration: none;
            color: #1B4D3E;
            font-weight: bold;
            margin-right: 5px;
        }
        .breadcrumbs a:hover {
            text-decoration: underline;
            color: #145A32;
        }
        .breadcrumbs .span {
            font-weight: bold;
            color: #555;
        }

        /* Sidebar */
        .categories-sidebar {
            height: calc(100vh - 70px);
            overflow-y: auto;
            background-color: #e2ede9;
            padding: 20px 40px 20px 20px;
            position: sticky;
            top: 70px;
            transition: all 0.3s ease;
            border-radius: 15px;
        }
        .category {
            cursor: pointer;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .category:hover {
            background-color: #d4e2de;
            transform: translateX(5px);
        }
        .category.active {
            background-color: #1B4D3E !important;
            color: white;
            transform: scale(1.02);
        }
        .category i {
            margin-right: 10px;
        }

        /* Plan Cards */
        .card {
            border-radius: 15px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            background: white;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.2);
        }
        .card-title {
            color: #1B4D3E;
            font-weight: bold;
        }
        .card-text {
            color: #555;
        }

        /* Custom Button */
        .custom-btn {
            background: white;
            color: #1B4D3E;
            border: 2px solid #1B4D3E;
            position: relative;
            overflow: hidden;
            transition: color 0.5s ease;
            z-index: 1;
            border-radius: 5px;
            padding: 8px 20px;
        }
        .custom-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #1B4D3E;
            transition: left 0.5s ease;
            z-index: -1;
        }
        .custom-btn:hover, .custom-btn:active {
            color: white;
        }
        .custom-btn:hover::before, .custom-btn:active::before {
            left: 0;
        }

        /* Search Bar */
        .search-container {
            position: relative;
            width: 300px;
            margin-left: auto;
        }
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border-radius: 25px;
            border: 1px solid #1B4D3E;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .search-input:focus {
            border-color: #145A32;
            box-shadow: 0 0 8px rgba(27, 77, 62, 0.3);
        }
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #1B4D3E;
            cursor: pointer;
        }

        /* No Results */
        .no-results {
            text-align: center;
            color: #145A32;
            padding: 20px;
            font-size: 1.2rem;
        }

        /* Scroll to Top */
        #scrollTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 50%;
            background: #1B4D3E;
            color: white;
            transition: 0.3s;
            display: none;
        }
        #scrollTopBtn:hover {
            background-color: #145A32;
            transform: scale(1.1);
        }

        /* Plan Recommendation Banner */
        .recommendation-banner {
            background: #1B4D3E;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            animation: fadeIn 1s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Plans Display */
        .plans-display {
            padding-left: 30px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .categories-sidebar {
                height: auto;
                position: relative;
                top: 0;
                padding: 15px 25px 15px 15px;
            }
            .category {
                padding: 10px;
            }
            .plans-display {
                padding-left: 15px;
            }
        }
         /* Footer */
         .footer {
            background: linear-gradient(135deg, #1B4D3E, #0F2A22);
        }
        .footer i {
            font-size: 24px;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .footer i:hover {
            transform: scale(1.3);
            color: #00C4B4;
        }

    </style>
</head>

<body>
    <!-- Navbar -->
    <div class="navbar navbar-expand-md bg-body-tertiary fixed-top h6">
        <div class="container-fluid">
            <a href="Login_page.html" class="navbar-brand text-decoration-none ms-2">
                <img src="images/prezee2.png" style="width: 50px;" alt="Prezee Logo">
            </a>
            <button class="navbar-toggler" data-bs-target="#links" data-bs-toggle="collapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="links" class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item"><a href="#services" class="nav-link me-2">Services</a></li>
                    <li class="nav-item"><a href="#" class="nav-link me-2">View Plans</a></li>
                    <li class="nav-item"><a href="#terms" class="nav-link me-2">Terms</a></li>
                    <li class="nav-item"><a href="#footer" class="nav-link me-2">Contact Us</a></li>
                    <li class="nav-item">
                        <a href="profilevalidation.html" class="nav-link me-1">
                            <button type="button" class="btn" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Login">
                                <i class="bi bi-person-circle text-white fs-5"></i>
                            </button>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Breadcrumbs -->
    <div class="container-fluid" id="bread">
        <nav class="breadcrumbs">
            <a href="Login_page.html">Home</a>>
            <a href="#" style="font-weight: bold; color: #555; text-decoration: none;">Plan</a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="container-fluid mt-1 pt-4 ps-5" id="plans1">
        <div class="row">
            <!-- Sidebar Categories -->
            <div class="col-md-3 categories-sidebar">
                <div class="container p-1 mb-2" style="color:#1B4D3E;">
                    <p class="text-center mb-2" id="userPhone"></p>
                </div>
                <h5 class="text-center mb-4 fw-bold" style="color:#1B4D3E; font-weight: 500;">Plan Categories</h5>
                <ul class="list-group" id="categories">
                    <!-- Categories will be populated dynamically -->
                </ul>
            </div>

            <!-- Plans Display -->
            <div class="col-md-9 plans-display">
                <div class="row align-items-center mb-4">
                    <div class="col mt-3">
                        <h3 id="selected-category" style="color:#1B4D3E; margin-left: 380px; font-weight: 700;">Popular Plans</h3>
                    </div>
                    <div class="col-auto">
                        <div class="search-container">
                            <input type="text" id="searchInput" class="search-input" placeholder="Search plans...">
                            <i class="bi bi-search search-icon"></i>
                        </div>
                    </div>
                </div>
                <div id="plan-container" class="row"></div>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()"><i class="bi bi-arrow-up"></i></button>

    <!-- Services Section -->
    <section id="services" class="container py-5 pt-3 mt-4 section-animate">
        <h2 class="text-center mb-4 pb-3" style="color: #1B4D3E;"><b>Our Services</b></h2>
        <div class="row g-4">
            <!-- Mobile Recharge -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-phone-fill fs-1 text-success"></i>
                        <h4 class="mt-3">Instant Mobile Recharge</h4>
                        <p>Recharge your mobile anytime, anywhere with our fast and secure prepay service.</p>
                    </div>
                </div>
            </div>
            <!-- WiFi Recharge -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-wifi fs-1 text-primary"></i>
                        <h4 class="mt-3">WiFi Subscription</h4>
                        <p>Prepay for your WiFi plans seamlessly and enjoy uninterrupted connectivity.</p>
                    </div>
                </div>
            </div>
            <!-- Subscription Management -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-credit-card-fill fs-1 text-warning"></i>
                        <h4 class="mt-3">Smart Auto-Prepay</h4>
                        <p>Enable auto-prepay for stress-free, uninterrupted service renewals.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Additional Services -->
        <div class="row g-4 mt-3">
            <!-- Usage Tracking -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-graph-up fs-1 text-purple"></i>
                        <h4 class="mt-3">Usage Tracking</h4>
                        <p>Monitor your recharge and subscription usage with real-time insights.</p>
                    </div>
                </div>
            </div>
            <!-- Multiple Payment Methods -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-wallet2 fs-1 text-success"></i>
                        <h4 class="mt-3">Multiple Payment Options</h4>
                        <p>Pay your way with a variety of secure methods, from cards to digital wallets.</p>
                    </div>
                </div>
            </div>
            <!-- 24/7 Support -->
            <div class="col-md-4">
                <div class="card text-center shadow service-card bounce-hover">
                    <div class="card-body">
                        <i class="bi bi-headset fs-1 text-info"></i>
                        <h4 class="mt-3">24/7 Customer Support</h4>
                        <p>Get assistance anytime with our dedicated support team, available round-the-clock.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Terms and Conditions -->
    <div id="terms">
        <h1 class="container py-5 d-flex justify-content-center" style="color: #1B4D3E;"><b>Terms and Conditions</b></h1>
        <div class="container" id="terms">
            <div class="row">
                <!-- Card 1: Introduction -->
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Introduction</h5>
                            <p class="card-text">This document outlines the terms and conditions with which you may use our services, including our website, mobile app, and other products.</p>
                        </div>
                    </div>
                </div>
                <!-- Card 2: Definitions -->
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Definitions</h5>
                            <p class="card-text">Throughout this document, 'we,' 'us,' and 'our' refer to the company, and 'you' refers to any user of our services.</p>
                        </div>
                    </div>
                </div>
                <!-- Card 3: Eligibility -->
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Eligibility</h5>
                            <p class="card-text">You must have a valid Mobi-Comm SIM to purchase and use our services. Our platform is exclusively available for Mobi-Comm users.</p>
                        </div>
                    </div>
                </div>
                <!-- Card 4: Privacy Policy -->
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Privacy Policy</h5>
                            <p class="card-text">We prioritize your privacy and ensure that your personal information is securely handled.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   
    <!-- Footer -->
    <footer class="footer mt-5 text-white py-4" id="contact">
        <div class="container text-center text-md-start">
            <div class="row">
                <!-- About Us -->
                <div class="col-md-4 mb-3">
                    <h5>About Mobile Prepay</h5>
                    <p>Mobile Prepay offers seamless prepaid mobile services with affordable plans, high-speed data, and excellent connectivity. Stay connected anytime, anywhere.</p>
                </div>
                <!-- Quick Links -->
                <div class="col-md-4 mb-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#plans" class="text-white text-decoration-none">Browse Plans</a></li>
                        <li><a href="#terms" class="text-white text-decoration-none">Terms & Conditions</a></li>
                        <li><a href="#contact" class="text-white text-decoration-none">Contact Support</a></li>
                    </ul>
                </div>
                <!-- Contact Information -->
                <div class="col-md-4">
                    <h5>Contact Us</h5>
                    <p>Email: support@mobileprepay.com</p>
                    <p>Phone: +1 800 123 4567</p>
                    <p>Address: 123, Digital Tower, Tech City</p>
                    <h5>Follow Us</h5>
                    <div>
                        <i class="bi bi-instagram m-2"></i>
                        <i class="bi bi-twitter-x m-2"></i>
                        <i class="bi bi-facebook m-2"></i>
                    </div>
                </div>
            </div>
            <hr class="bg-light">
            <!-- Copyright Notice -->
            <div class="text-center mt-3">
                <p class="mb-0">
                    “PreZee” trademark is owned by Mobi-Comm Limited. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Scroll to Top
        let scrollBtn = document.getElementById("scrollTopBtn");
        window.onscroll = function() {
            if (document.documentElement.scrollTop > 300) {
                scrollBtn.style.display = "block";
            } else {
                scrollBtn.style.display = "none";
            }
        };
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        // Plans Logic
        document.addEventListener("DOMContentLoaded", function () {
            const planContainer = document.getElementById("plan-container");
            const categoryTitle = document.getElementById("selected-category");
            const searchInput = document.getElementById("searchInput");
            let currentCategory = "Popular Plans"; // Default category name

            // Fetch and display categories dynamically
            fetchCategories();

            // Initial display of plans
            displayPlans(currentCategory);

            // Login function (example, integrate with your login page)
            function login(username, password) {
                fetch("http://localhost:8083/api/public/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: username, password: password })
                })
                    .then(response => {
                        if (!response.ok) throw new Error("Login failed");
                        return response.json();
                    })
                    .then(data => {
                        localStorage.setItem("jwtToken", data.token);
                        fetchCategories(); // Reload data after login
                        displayPlans(currentCategory);
                    })
                    .catch(error => {
                        console.error("Login error:", error);
                        alert("Login failed. Please check your credentials.");
                    });
            }

            // Fetch categories from backend
            function fetchCategories() {
                fetch("http://localhost:8083/api/plans/categories", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("jwtToken") // Add JWT token
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(categories => {
                        console.log("Categories fetched:", categories);
                        const categoryList = document.getElementById("categories");
                        categoryList.innerHTML = "";
                        if (!Array.isArray(categories) || categories.length === 0) {
                            categoryList.innerHTML = "<li>No categories available</li>";
                            return;
                        }
                        categories.forEach(category => {
                            const isActive = category.name === currentCategory ? "active" : "";
                            const categoryItem = `
                                <li class="list-group-item category p-4 ${isActive}" data-category="${category.name}">
                                    ${category.name}
                                </li>
                            `;
                            categoryList.innerHTML += categoryItem;
                        });
                        addCategoryListeners();
                    })
                    .catch(error => {
                        console.error("Error fetching categories:", error.message);
                        document.getElementById("categories").innerHTML = `<li>Error: ${error.message}. Please login or check the server.</li>`;
                    });
            }

            // Add event listeners to categories
            function addCategoryListeners() {
                document.querySelectorAll(".category").forEach(category => {
                    category.addEventListener("click", function () {
                        document.querySelectorAll(".category").forEach(cat => cat.classList.remove("active"));
                        this.classList.add("active");
                        const selectedCategory = this.getAttribute("data-category");
                        displayPlans(selectedCategory, searchInput.value);
                    });
                });
            }

            // Fetch and display plans
            function displayPlans(category, searchTerm = "") {
                currentCategory = category;
                categoryTitle.textContent = category;

                fetch(`http://localhost:8083/api/plans/category/name/${encodeURIComponent(category)}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("jwtToken") // Add JWT token
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(plans => {
                        console.log("Plans fetched:", plans);
                        planContainer.innerHTML = "";
                        let filteredPlans = plans;

                        if (searchTerm) {
                            const searchValue = searchTerm.toLowerCase().trim();
                            const isPriceSearch = /^\d+$/.test(searchValue);
                            const isDataSearch = /(\d+(\.\d+)?)(gb|mb)/i.test(searchValue);

                            filteredPlans = filteredPlans.filter(plan => {
                                const price = plan.amount.toString(); // Backend returns BigDecimal
                                const detailsLower = plan.details.toLowerCase();

                                if (isPriceSearch) {
                                    return price === searchValue;
                                } else if (isDataSearch) {
                                    return detailsLower.includes(searchValue);
                                } else {
                                    return price.includes(searchValue) || detailsLower.includes(searchValue);
                                }
                            });
                        }

                        if (filteredPlans.length > 0) {
                            filteredPlans.forEach(plan => {
                                const planCard = `
                                    <div class="col-md-4 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">₹${plan.amount}</h5>
                                                <p class="card-text">${plan.details} | ${plan.validityDays} days</p>
                                                <div class="d-flex justify-content-center">
                                                    <button class="btn rounded-2 custom-btn buy-btn"
                                                        data-plan_id="${plan.planId}"
                                                        data-name="₹${plan.amount}"
                                                        data-details="${plan.details}"
                                                        data-category="${plan.category.name}"
                                                        data-amount="${plan.amount}">
                                                        Buy Now
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                planContainer.innerHTML += planCard;
                            });

                            document.querySelectorAll(".buy-btn").forEach(button => {
                                button.addEventListener("click", function () {
                                    const selectedPlan = {
                                        plan_id: this.getAttribute("data-plan_id"),
                                        name: this.getAttribute("data-name"),
                                        details: this.getAttribute("data-details"),
                                        category: this.getAttribute("data-category"),
                                        amount: this.getAttribute("data-amount")
                                    };
                                    localStorage.setItem("selectedPlan", JSON.stringify(selectedPlan));
                                    window.location.href = "Payment1.html";
                                });
                            });
                        } else {
                            planContainer.innerHTML = `
                                <div class="col-12 no-results mt-4">
                                    <img src="images/not found.avif" style="width: 400px; opacity: 0.3;" alt="No plans found">
                                    <p>Sorry! No plans available for this category.</p>
                                </div>
                            `;
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching plans:", error.message);
                        planContainer.innerHTML = `
                            <div class="col-12 no-results mt-4">
                                <p>Error loading plans: ${error.message}. Please login or check the server.</p>
                            </div>
                        `;
                    });
            }

            // Search functionality
            searchInput.addEventListener("input", function () {
                console.log("Search term:", this.value);
                displayPlans(currentCategory, this.value);
            });

            // Display phone number
            const phoneNumber = localStorage.getItem("userPhoneNumber");
            if (phoneNumber) {
                document.getElementById("userPhone").innerHTML = `<strong>Phone Number:</strong> ${phoneNumber}`;
            }

            // Example: Trigger login manually (replace with your login page logic)
            // login("yourMobileNumber", "yourPassword"); // Uncomment and adjust to test
        });
    </script>
</body>
</html>